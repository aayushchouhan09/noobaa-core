/* Copyright (C) 2024 NooBaa */
'use strict';

const { NewlineReader } = require("../../../util/file_reader");

/**
 * 
 * @param {Buffer} fs_buf 
 * @returns {nb.NativeFile}
 */
function mocked_file_handler(fs_buf) {
	// @ts-ignore
	return {
		read: async (_fs_ctx, buf, offset, len, pos) => {
			const read = Math.max(Math.min(fs_buf.length - pos, buf.length - offset, len), 0);
			const data = fs_buf.subarray(pos, pos + read);

			buf.fill(data, offset, offset + read);
			return read;
		}
	};
}

describe('newline_reader', () => {
	describe('nextline', () => {
		const UTF8DATA_ARR = [
			'/15游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/14游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/13游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/12游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/11游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/10游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/9游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/8游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/7游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/6游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/5游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/4游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/3游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/2游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/x.txt',
			'/14游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/13游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/12游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/11游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/10游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/9游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/8游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/7游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/6游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/5游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/4游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/3游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/2游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/x.txt',
			'/11游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/10游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/9游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/8游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/7游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/6游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/5游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/4游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/3游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/2游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/x.txt',
			'/12游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/11游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/10游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/9游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/8游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/7游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/6游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/5游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/4游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/3游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/2游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/x.txt',
			'/10游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/9游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/8游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/7游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/6游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/5游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/4游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/3游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/2游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/x.txt',
			'/16游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/15游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/14游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/13游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/12游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/11游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/10游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/9游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/8游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/7游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/6游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/5游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/4游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/3游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/2游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/x.txt',
			'/17游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/16游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/15游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/14游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/13游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/12游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/11游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/10游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/9游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/8游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/7游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/6游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/5游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/4游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/3游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/2游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/x.txt',
			'/13游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/12游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/11游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/10游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/9游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/8游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/7游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/6游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/5游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/4游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/3游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/2游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때游때/x.txt',
		];

		it('can process utf8 characters when termination with newline character', async () => {
			const UTF8DATA_BUF = Buffer.from(UTF8DATA_ARR.join('\n') + '\n', 'utf8');

			const reader = new NewlineReader({}, '', { skip_leftover_line: true });
			// @ts-ignore
			reader.fh = mocked_file_handler(UTF8DATA_BUF);

			const result = [];
			const [processed] = await reader.forEach(async entry => {
				result.push(entry);
				return true;
			});

			expect(processed).toBe(UTF8DATA_ARR.length);
			expect(result).toStrictEqual(UTF8DATA_ARR);
		});

		it('read_file_offset - can process utf8 characters when termination with newline character', async () => {
			const UTF8DATA_BUF = Buffer.from(UTF8DATA_ARR.join('\n') + '\n', 'utf8');

			const reader = new NewlineReader({}, '', { skip_leftover_line: true, read_file_offset: 0 });
			// @ts-ignore
			reader.fh = mocked_file_handler(UTF8DATA_BUF);

			const result = [];
			let expected_cur_next_line_file_offset = 0;
			const [processed] = await reader.forEach(async entry => {
				result.push(entry);
				expected_cur_next_line_file_offset += Buffer.byteLength(entry, 'utf8') + 1;
				expect(reader.next_line_file_offset).toBe(expected_cur_next_line_file_offset);
				return true;
			});

			expect(processed).toBe(UTF8DATA_ARR.length);
			expect(result).toStrictEqual(UTF8DATA_ARR);
		});

		it('can process utf8 characters when termination not with new line character', async () => {
			const UTF8DATA_BUF = Buffer.from(UTF8DATA_ARR.join('\n'), 'utf8');

			const reader = new NewlineReader({}, '');
			// @ts-ignore
			reader.fh = mocked_file_handler(UTF8DATA_BUF);

			const result = [];
			const [processed] = await reader.forEach(async entry => {
				result.push(entry);
				return true;
			});

			expect(processed).toBe(UTF8DATA_ARR.length);
			expect(result).toStrictEqual(UTF8DATA_ARR);
		});

		it('read_file_offset - can process utf8 characters when termination not with new line character', async () => {
			const UTF8DATA_BUF = Buffer.from(UTF8DATA_ARR.join('\n'), 'utf8');

			const reader = new NewlineReader({}, '', { read_file_offset: 0 });
			// @ts-ignore
			reader.fh = mocked_file_handler(UTF8DATA_BUF);

			const result = [];
			let expected_cur_next_line_file_offset = 0;
			const [processed] = await reader.forEach(async entry => {
				result.push(entry);
				expected_cur_next_line_file_offset += Buffer.byteLength(entry, 'utf8') + (reader.eof ? 0 : 1);
				expect(reader.next_line_file_offset).toBe(expected_cur_next_line_file_offset);
				return true;
			});

			expect(processed).toBe(UTF8DATA_ARR.length);
			expect(result).toStrictEqual(UTF8DATA_ARR);
		});

		it('read_file_offset starts from the second line - can process utf8 characters when termination not with new line character', async () => {
			const UTF8DATA_BUF = Buffer.from(UTF8DATA_ARR.join('\n'), 'utf8');
			const expected_to_be_processed_data_array = UTF8DATA_ARR.slice(1);
			const initial_next_line_file_offset = Buffer.byteLength(UTF8DATA_ARR[0], 'utf8') + 1;
			const reader = new NewlineReader({}, '', { read_file_offset: initial_next_line_file_offset});
			// @ts-ignore
			reader.fh = mocked_file_handler(UTF8DATA_BUF);

			const result = [];
			let expected_cur_next_line_file_offset = initial_next_line_file_offset;
			const [processed] = await reader.forEach(async entry => {
				result.push(entry);
				expected_cur_next_line_file_offset += Buffer.byteLength(entry, 'utf8') + (reader.eof ? 0 : 1);
				expect(reader.next_line_file_offset).toBe(expected_cur_next_line_file_offset);
				return true;
			});

			expect(processed).toBe(expected_to_be_processed_data_array.length);
			expect(result).toStrictEqual(expected_to_be_processed_data_array);
		});

		it('can process utf8 characters when termination not with new line character [bufsize = 256]', async () => {
			const expected = "abc";
			const UTF8DATA_ARR_TEMP = [ ...UTF8DATA_ARR, expected ];
			const UTF8DATA_BUF = Buffer.from(UTF8DATA_ARR_TEMP.join('\n'), 'utf8');

			const reader = new NewlineReader({}, '', { bufsize: 256, skip_overflow_lines: true });
			// @ts-ignore
			reader.fh = mocked_file_handler(UTF8DATA_BUF);

			const result = [];
			const [processed] = await reader.forEach(async entry => {
				result.push(entry);
				return true;
			});

			expect(processed).toBe(1);
			expect(result).toStrictEqual([expected]);
		});

		it('read_file_offset - can process utf8 characters when termination not with new line character [bufsize = 256]', async () => {
			const expected = "abc";
			const UTF8DATA_ARR_TEMP = [ ...UTF8DATA_ARR, expected ];
			const UTF8DATA_BUF = Buffer.from(UTF8DATA_ARR_TEMP.join('\n'), 'utf8');

			const reader = new NewlineReader({}, '', { bufsize: 256, skip_overflow_lines: true, read_file_offset: 0 });
			// @ts-ignore
			reader.fh = mocked_file_handler(UTF8DATA_BUF);

			const result = [];
			const [processed] = await reader.forEach(async entry => {
				result.push(entry);
				return true;
			});

			expect(processed).toBe(1);
			expect(result).toStrictEqual([expected]);
			const expected_cur_next_line_file_offset = UTF8DATA_BUF.length;
			expect(reader.next_line_file_offset).toBe(expected_cur_next_line_file_offset);
		});
	});
});
